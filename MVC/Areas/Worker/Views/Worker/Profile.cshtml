@model OmSaiModels.Worker.WorkerChangePasswordModel;

@{
    ViewData["Title"] = "Worker Profile";

    var worker = @ViewBag.AllData;
    var fullName = worker.FirstName + " " + worker.MiddleName + " " + worker.LastName;
    var attendanceHistory = ViewBag.AttendanceHistory; //test commentn

    var address = ViewBag.Addresses;
    // Ensure there are at least two items in the collection before accessing
    var PermanentAddress = address.Count > 0 ? address[0]?.Address ?? "" : "";
    var CurrentAddress = address.Count > 1 ? address[1]?.Address ?? "" : "";

    int serialNumber = 0;

    if (ViewBag.Ledger != null)
    {
        var ledger = ViewBag.Ledger;
    }

    var bank = ViewBag.BankDetails;


}

<style>

    .border-danger{
    border:0px solid maroon;
    box-shadow: 1px 1px 5px maroon;
    }

    .selfie-image{
    width:40px;
    border:1px solid #eee;
    border-radius:5px;
    box-shadow: 1px 1px 3px gray;
    }

    .calendar {
    display: grid;
    grid-template-columns: repeat(7, 1fr); /* 7 columns for the days of the week */
    gap: 5px;
    }

    .calendar-box {
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-size: 14px;
    font-weight: bold;
    }

    .calendar-box.P {
    background-color: #28a745; /* Green for Present */
    color: #fff;
    }

    .calendar-box.A {
    background-color: #dc3545; /* Red for Absent */
    color: #fff;
    }

    .calendar-box.L {
    background-color: #ed9809; /* Red for Absent */
    color: #fff;
    }

    .calendar-box.empty {
    background-color: #f8f9fa; /* Light gray for empty days */
    }

    .calendar-header {
    text-align: center;
    font-weight: bold;
    margin-bottom: 10px;
    }

    .calendar-header .col{
    width: 30px;
    height: 30px;
    font-size:11px;
    text-align:center;
    }

    .list-group-item {
    padding: 0.35rem 0.50rem !important; 
    }

</style>

<div class="my-3 my-md-5">
    <div class="container">
        <div class="row">
            <partial name="~/Views/shared/_alertpartial.cshtml" />
        </div>
        <div class="row">
            <div class="col-lg-4">
                <div class="card">
                    <div class="card-header d-flex">
                        <a asp-area="worker" asp-controller="worker" asp-action="Edit" asp-route-id="@worker.WorkerId" class="btn btn-outline-warning ml-1"><i class="fe fe-edit"></i> Edit</a>
                        <a class="btn btn-outline-warning ml-1"  onclick="$('#topcard').show()"><i class="fe fe-lock"></i> Password</a>
                        <!-- Upload Profile Image Button -->
                        <button type="button" class="btn btn-outline-primary ml-auto btn-upload2" data-worker-id="@worker.WorkerId" data-bs-toggle="modal" data-bs-target="#ppUploadImageModal">
                            <i class="fe fe-camera"></i>
                        </button>
                    </div>
                </div>

                <div class="card" id="topcard" style="display: @(ViewBag.IsChangePasswordPage != null? "block":"none");">


                    <form method="post" asp-area="Worker" asp-controller="Worker" asp-action="WorkerChangePassword" id="changepasswordcard">
                        <div class="card-body">
                            <h4>Reset Password</h4>

                            <input type="hidden" asp-for="WorkerId" value='@worker.WorkerId'  >

                            <div asp-validation-summary="ModelOnly" class="text-danger" role="alert"></div>
                            <div class="form-floating mb-3">
                                <label asp-for="OldPassword" class="form-label">Old Password: <small class="text-muted">(@worker.Password)</small></label>
                                <input type="password" asp-for="OldPassword" id="oldPassword" value="@worker.Password" class="form-control" placeholder="Enter Old Password" required />
                                <span asp-validation-for="OldPassword" class="text-danger"></span>
                            </div>
                            <div class="form-floating mb-3">
                                <label asp-for="NewPassword" class="form-label">New Password:</label>
                                <input type="password" asp-for="NewPassword" id="NewPassword" class="form-control" placeholder="Enter New Password" required />
                                <span asp-validation-for="NewPassword" class="text-danger"></span>
                            </div>
                            <div class="form-floating mb-3">
                                <label asp-for="ConfirmPassword" class="form-label">Confirm New Password:</label>
                                <input type="password" asp-for="ConfirmPassword" id="ConfirmNewPassword" class="form-control" placeholder="Enter Confirm Password" required />
                                <span asp-validation-for="ConfirmPassword" class="text-danger"></span>
                            </div>
                            <div class="text-center">
                                <button type="submit" class="btn btn-outline-secondary" id="btnSubmit">Set</button>
                                <button type="button" class="btn btn-outline-warning"  onclick="$('#topcard').hide()">Cancel</button>
                            </div>
                            @*  <div>
                                <button id="login-submit" type="submit" class="w-100 btn btn-primary ">Set Password</button>
                            </div> *@
                        </div>
                    </form>


                </div>


                <div class="card">
                    <div class="card-body">
                        <div class="media">
                            @* <span class="avatar avatar-xxl mr-5" style="background-image: url('@user.ImagePath')"></span> *@

                            @* <span class="avatar avatar-xxl mr-5" style="background-image: url(demo/faces/male/21.jpg)">
                                <i class="fe fe-camera"></i>    
                            </span> *@

                            <!-- Profile Image Display -->
                            @if ( worker.ProfileImage!=null)
                            {
                                <div class="text-center mt-3">
                                    <span id="profileImage" class="avatar avatar-xxl"
                                    style="background-image: url('@Url.Content($"~/{worker.ProfileImage}")')">

                                    </span>

                                </div>
                            }
                            else
                            {
                                <div class="text-center mt-3">
                                    <span id="profileImage" class="avatar avatar-xxl" style="background-image: url('/demo/faces/profile-picture.png')"></span>
                                </div>
                            }

                            <div class="media-body">
                                <h4 class="m-0 mb-1">@fullName</h4>
                                <p class="text-muted mb-1"><b class="text-info">@worker.WorkmanId</b> [ <b>@worker.DepartmentName</b>]</p>
                                <p class="text-muted mb-1">Qualification: <b>@worker.QualificationName</b></p>

                                <ul class="social-links list-inline mb-0 mt-2">
                                    <li class="list-inline-item">
                                        <i class="fa fa-phone"></i> &nbsp;&nbsp; @worker.MobileNumbers
                                    </li>
                                </ul>
                                <p><b>Joining Date: </b> @worker.DateofJoining </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card @(worker.WorkerShiftId == null?"border-danger":"")">
                    <div class="card-header ">
                        <h4 class="card-title">Current Shift</h4>
                    </div>
                    @if (worker.WorkerShiftId != null){
                        <div class="card-body p-2" id="card-workershift-display">

                            <button type="button" class="btn btn-sm btn-warning" style="float:right;" onclick="EditShift()" id="btnEditShift">Edit</button>

                            @worker.ShiftName (@DateTime.Today.Add(@worker.StartTime).ToString("hh:mm tt") -
                            @DateTime.Today.Add(@worker.EndTime).ToString("hh:mm tt"))
                        </div>
                    }


                    <div class="card-body p-2 @(worker.WorkerShiftId == null?"":"d-none")" id="card-workershift-form">
                        <form id="formWorkerShift" method="post">

                            <input type="hidden" id="txtWorkerId1" value="@worker.WorkerId" />
                            <div class="mb-3">
                                <label class="form-label" for="drpShiftId"> Shift Time </label>
                                <select class="form-control" id="drpShiftId">
                                    @foreach (var shift in ViewBag.SiteShifts)
                                    {
                                        <option value="@shift.SiteShiftId">
                                            @shift.ShiftName : (@DateTime.Today.Add(@shift.StartTime).ToString("hh:mm tt") -
                                            @DateTime.Today.Add(@shift.EndTime).ToString("hh:mm tt"))
                                        </option>
                                    }
                                </select>
                            </div>

                            <div class="text-center">

                                <button class="btn btn-outline-primary" type="submit" id="btnSaveformWorkerShift"><i class="fe fe-save"></i> Save</button>
                                <button class="btn btn-outline-danger" type="button" id="btnCancelformWorkerShift" onclick="cancelShift()"><i class="fe fe-x"></i> Cancel</button>
                            </div>
                        </form>

                    </div>
                </div>


                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Address</h3>
                    </div>

                    <div class="card-body">
                        <div class="media">
                            <div class="media-body">
                                <b>Permanent Address: </b>
                                <p class="text-muted mb-0">@PermanentAddress</p>
                                <hr />
                                <b>Current Address: </b>
                                <p class="text-muted mb-0">@CurrentAddress</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Project And Site</h3>
                    </div>

                    <div class="card-body">
                        <div class="media">
                            <div class="media-body">
                                <p class="m-0"><b>@worker.ProjectName</b></p>
                                <p class="text-muted mb-0">Site: <b>@worker.SiteName, @worker.SiteLocation</b></p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Current Month Attendace</h3>
                    </div>
                    <div class="card-body">

                        <div class="container p-2">
                            @if (ViewBag.Ledger != null)
                            {
                                var ledger = ViewBag.Ledger;
                                <ul class="list-group list-group-numbered mb-4">
                                    <li class="list-group-item d-flex justify-content-between align-items-start">
                                        <div class="ms-2 me-auto">
                                            <div class="fw-bold">Total Days</div>
                                        </div>
                                        <span class="badge bg-primary rounded-pill">@ledger.TotalDays</span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-start">
                                        <div class="ms-2 me-auto">
                                            Present
                                        </div>
                                        <span class="badge bg-primary rounded-pill">@ledger.DaysPresent</span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-start">
                                        <div class="ms-2 me-auto">
                                            Absent
                                        </div>
                                        <span class="badge bg-primary rounded-pill">@ledger.DaysAbsent</span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-start">
                                        <div class="ms-2 me-auto">
                                            Leave
                                        </div>
                                        <span class="badge bg-primary rounded-pill">@ledger.DaysLeave</span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-start">
                                        <div class="ms-2 me-auto">
                                            Half Day
                                        </div>
                                        <span class="badge bg-primary rounded-pill">@ledger.DaysHalfDay</span>
                                    </li>
                                </ul>
                            }


                            <!-- Calendar Header -->
                            <div class="calendar-header row text-center">
                                <div class="col">Sun</div>
                                <div class="col">Mon</div>
                                <div class="col">Tue</div>
                                <div class="col">Wed</div>
                                <div class="col">Thu</div>
                                <div class="col">Fri</div>
                                <div class="col">Sat</div>
                            </div>


                            <!-- Calendar Grid -->
                            <div class="calendar">

                                @if (ViewBag.Ledger != null)
                                {
                                    @for (int day = 1; day <= ViewBag.DayNumber; day++)
                                    {
                                        <div class="calendar-box empty"></div>
                                    }

                                    var ledger = ViewBag.Ledger;
                                    @for (int day = 1; day <= 31; day++)
                                    {
                                        string status = ledger.GetType().GetProperty($"Day{day}")?.GetValue(ledger);
                                        <div class="calendar-box @status">@day</div>
                                    }

                                }

                            </div>
                        </div>


                    </div>
                </div>




            </div>
            <div class="col-lg-8">

                <div class="card">
                    <div class="card-header">
                                <h4 class="card-title">Worker Attendance</h4>
                    </div>
                    <div class="table-responsive">

                        <table class="table card-table table-vcenter text-nowrap">
                            <thead>
                                <tr>
                                    <th class="w-1">No.</th>
                                    <th>Date</th>
                                    <th>Site Name</th>
                                    <th>In Time</th>
                                    <th>Out Time</th>
                                    <th>Working Hours</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var attendance in attendanceHistory)
                                {
                                    serialNumber++;
                                    var timeDifference = "---";

                                    // Check if both InTime and OutTime are not null

                                    if (attendance.OutTime is DateTime outTime && attendance.InTime is DateTime inTime)
                                    {
                                        var difference = outTime - inTime;
                                        timeDifference = $"{difference.Hours} Hrs {difference.Minutes} Min";

                                        // Use difference as needed
                                    }

                                    @* if (attendance.OutTime.HasValue && attendance.InTime.HasValue) *@
                                    @* { *@
                                    @*     var difference = attendance.OutTime.Value - attendance.InTime.Value; *@
                                    @*     // Use difference as needed *@
                                    @*     timeDifference = $"{difference.Hours} Hrs {difference.Minutes} Min"; *@

                                    @* } *@




                                    <tr>
                                        <td>@serialNumber</td>
                                        <td>@attendance.CreatedAt?.ToString("ddd, dd MMM yy")</td>
                                        <td>@attendance.SiteName</td>
                                        <td>
                                            <img src="@attendance.InSelfiPath" class="selfie-image" /><br />
                                            @attendance.InTime?.ToString("hh:mm tt")
                                        </td>
                                        <td>
                                            <img src="@attendance.OutSelfiPath" class="selfie-image" /><br />
                                            @attendance.OutTime?.ToString("hh:mm tt")
                                        </td>
                                        <td>@timeDifference</td>
                                        <td>

                                            @if (attendance.Status == "Present")
                                            {
                                                <span class="badge bg-success">P</span> @attendance.Status
                                            }
                                            else if (attendance.Status == "Absent")
                                            {
                                                <span class="badge bg-danger">A</span> @attendance.Status
                                            }
                                            else if (attendance.Status == "Miss")
                                            {
                                                <span class="badge bg-warning">I</span> @("In")
                                            }else{
                                                <span class="badge bg-dark">@attendance.Status</span>
                                            }
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="card shadow">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Wotker Bank Details</h5>
                        <div>
                            <a asp-area="worker" asp-controller="Bank" asp-action="Create" asp-route-id="@worker.WorkerId" class="btn btn-outline-white bg-white" target="_blank" >Update Bank Details</a>
                        </div>
                    </div>
                    @if (bank != null)
                    {
                        <div class="card-body">
                            <div class="row m-0">
                                <div class="col-lg-4 col-md-4 col-sm-12">
                                    <p class="mb-0"><strong>Account Holder:</strong></p>
                                    <p id="accountHolder">@(bank.AccountHolderName ?? "")</p>
                                </div>
                                <div class="col-lg-4 col-md-4 col-sm-12">
                                    <p class="mb-0"><strong>Account Number:</strong></p>
                                    <p id="accountNumber">@(bank.AccountNumber ?? "")</p>
                                </div>
                                <div class="col-lg-4 col-md-4 col-sm-12">
                                    <p class="mb-0"><strong>Bank Name:</strong></p>
                                    <p id="bankName">@(bank.BankName ?? "")</p>
                                </div>
                                <div class="col-lg-4 col-md-4 col-sm-12">
                                    <p class="mb-0"><strong>IFSC Code:</strong></p>
                                    <p id="ifscCode">@(bank.IfscCode ?? "")</p>
                                </div>
                                <div class="col-lg-4 col-md-4 col-sm-12">
                                    <p class="mb-0"><strong>Branch:</strong></p>
                                    <p id="branch">@(bank.BranchName ?? "")</p>
                                </div>
                                <div class="col-lg-4 col-md-4 col-sm-12">
                                    <p class="mb-0"><strong>Last Updated At</strong></p>
                                    <p id="branch">@bank.UpdatedAt.ToString("dd/mm/yyyy h:m")</p>
                                </div>

                            </div>
                        </div>
                    }
                </div>




                <div class="row">
                <div class="card">
                   
                    <div class="card-header">
                        <h4>Worker Documents</h4>
                    </div>

                    <div class="table-responsive">
                        <table class="table card-table table-vcenter text-nowrap">
                            <thead>
                                <tr>
                                    <th class="w-1">No.</th>
                                    <th>Document Name</th>
                                    <th>Uploads</th>
                                    <th>Last Updated</th>
                                    <th>Status</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                @{
                                    serialNumber = 0;
                                }

                                @foreach (var doc in ViewBag.WorkerDocuments)
                                {
                                    serialNumber++;
                                    <tr>
                                        <td>@serialNumber</td>
                                        <td>@doc.DocumentName</td>
                                        <td>
                                            @if(@doc.IsDocumentImage == true){
                                                @if (!string.IsNullOrEmpty(doc.DocumentImage))
                                                {
                                                    <a href="~/@doc.DocumentImage" target="_blank">
                                                        <img src="~/@doc.DocumentImage" alt="Uploaded Document" class="media-object mr-4" style="max-height:50px;" />
                                                    </a>
                                                    <br />

                                                }
                                                else
                                                {
                                                    <div class="media-object avatar avatar-md mr-4" style="background-image: url(demo/faces/male/16.jpg)"></div>
                                                    <br />

                                                }
                                            }
                                            @if (@doc.IsDocumentNumber == true)
                                            {
                                                @doc.DocumentNumber
                                            }
                                            
                                        </td>
                                        @* <td>
                                            <div class="media-object avatar avatar-md mr-4" style="background-image: url(demo/faces/male/16.jpg)"></div>
                                            @doc.DocumentImage<br />
                                            @doc.DocumentNumber
                                        </td> *@
                                        <td>
                                            @if (doc.DocumentNumber != null || doc.DocumentImage != null)
                                            {
                                                @doc.UpdatedAt
                                            }
                                        </td>
                                        <td>
                                            @if (doc.DocumentNumber != null || doc.DocumentImage != null)
                                            {
                                                @if (doc.IsVerified == true)
                                                {
                                                    <span class="status-icon bg-success"></span> <span>Verified</span>
                                                }
                                                else
                                                {
                                                    <span class="status-icon bg-danger"></span> <span>Not Verified</span>
                                                    @* <button class="btn btn-primary btn-sm" onclick="verifyDocument(doc.DocumentId)">Verify</button> *@
                                                    <a class=" btn btn-primary btn-sm btn-verify" data-document-id="@doc.WorkerDocumentId">
                                                        Verify
                                                     @*   data_id="@doc.id"
                                                       data_display="@doc.IsVerified"> *@
                                                        @* <i class="fe fe-check"></i> *@
                                                    </a>
                                                }
                                            }else{
                                                 <span>-</span>
                                            }

                                        </td>
                                        <td>
                                          @*   <button class="btn btn-info btn-warning">
                                                <i class="fe fe-check"></i>
                                            </button> *@
                                            <button class="btn btn-info btn-upload"
                                                    data-document_id="@doc.DocumentId"
                                                    data-document_name="@doc.DocumentName"
                                                    data-document_image="@doc.DocumentImage"
                                                    data-document_number="@doc.DocumentNumber"
                                                    data-is_document_number="@doc.IsDocumentNumber"
                                                    data-is_document_image="@doc.IsDocumentImage"
                                                    data-worker_id="@doc.WorkerId">
                                                <i class="fe fe-upload"></i>
                                            </button >
                                        </td>
                                    </tr>

                                }

                            </tbody>
                        </table>
                    </div>
                </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        @* For verify document pop-up  *@
<div class="modal fade" id="verify_model" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body text-center">
                <form method="post" id="formVerify" asp-area="Worker" asp-controller="Worker" asp-action="VerifyDocument">
                    <h2><i class="bi bi-check-circle"></i>Are you sure want to Verify ?</h2>
                    <input type="hidden" name="id" id="verify_id" value="" />
                    <input type="hidden" name="IsVerified" value="true" />

                    <button type="button" class="main-btn btn btn-warning cancel" id="closeModel" data-dismiss="modal">No</button>
                    @* <input type="hidden" name="id" id="verify_id" value="" /> *@
                    <input type="submit" value="Yes" class="main-btn btn btn-success" id="btnFormVerify" />
                </form>
            </div>
        </div>
    </div>
</div>



<!-- Modal for uploading profile image -->
<div class="modal fade" id="ppUploadImageModal" tabindex="-1" aria-labelledby="ppUploadImageModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="ppUploadImageModalLabel">Upload Profile Image</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="ppImageUploadForm">
                    <!-- Hidden WorkerId input -->
                    <input type="hidden" id="ppTxtWorkerId" value="@worker.WorkerId">

                    <div class="mb-3">
                        <label for="ppImageInput" class="form-label">Select Image</label>
                        <input type="file" class="form-control" id="ppImageInput" accept="image/*">
                        <input class="form-control" type="hidden" id="profileImage">
                    </div>
                    <div class="mb-3">
                        <!-- Image preview -->
                        <img id="ppImagePreview" src="#" alt="Selected Image" class="img-fluid d-none" style="max-height: 200px;">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btnCloseModal" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="ppImageUploadBtn">Upload</button>
            </div>
        </div>
    </div>
</div>



<!-- Modal -->
<div class="modal fade" id="uploadImageModal" tabindex="-1" aria-labelledby="uploadImageModalLabel" aria-hidden="true" data-backdrop="false" style="background: rgba(0, 0, 0, 0.5).">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="uploadImageModalLabel">Upload Document</h5>
                <button type="button" class="btn btn-close btnCloseModal" data-bs-dismiss="modal" aria-label="Close">
                    <b class="fe fe-x"></b>
                </button>
            </div>
            <div class="modal-body">
                <form id="imageUploadForm">
                    <input type="hidden" id="txtWorkerId">
                    <input type="hidden" id="txtDocumentId">
                    <div class="mb-3">
                        <label for="imageInput" class="form-label">Document Name</label>
                        <input class="form-control" type="text" id="txtDocumentName" value="Aadhar Card" disabled readonly>
                    </div>
                    <div class="mb-3 isDocumentNumber">
                        <label for="imageInput" class="form-label">Document Number</label>
                        <input class="form-control" type="text" id="txtDocumentNumber" value="285412541201">

                    </div>
                    <div class="mb-3 isDocumentImage">
                        <label for="imageInput" class="form-label">Select Image</label>
                        <input class="form-control" type="file" id="imageInput" accept="image/*">
                        <input class="form-control" type="hidden" id="documentImage">

                    </div>
                    <div class="mb-3 isDocumentImage">
                        @* <label class="form-label">Preview</label> *@
                        <div>
                            <img id="imagePreview" src="#" alt="Selected Image" class="img-fluid d-none" style="max-height: 200px;">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btnCloseModal" data-bs-dismiss="modal">Close</button>
                <button type="submit" class="btn btn-primary" form="imageUploadForm">Upload</button>
            </div>
        </div>
    </div>
</div>
@section Scripts {

    <script>
        $(document).ready(function () {
            // Open modal and set WorkerId dynamically
            $('.btn-upload2').on('click', function () {
                $('#ppUploadImageModal').modal('show');  // Open modal
                const workerId = $(this).data('worker-id');  // Get WorkerId from the button
                $('#ppTxtWorkerId').val(workerId);  // Set WorkerId in hidden input
                $('#ppImageInput').val('');  // Reset the file input field
                $('#ppImagePreview').addClass('d-none');  // Hide preview initially
            });

            // Close the modal when clicking close button
            $('.btnCloseModal').on('click', function () {
                $('#ppUploadImageModal').modal('hide');
            });

            // Show image preview when file is selected
            document.getElementById('ppImageInput').addEventListener('change', function (event) {
                const imageInput = event.target;
                const preview = document.getElementById('ppImagePreview');

                if (imageInput.files && imageInput.files[0]) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        preview.src = e.target.result;
                        preview.classList.remove('d-none');
                    };
                    reader.readAsDataURL(imageInput.files[0]); // Preview the selected image
                } else {
                    preview.src = '#';
                    preview.classList.add('d-none');
                }
            });

            // AJAX image upload on form submission
            $('#ppImageUploadBtn').on('click', function () {
                const formData = new FormData();
                const fileInput = document.getElementById('ppImageInput');

                if (fileInput.files && fileInput.files.length > 0) {
                    formData.append('file', fileInput.files[0]);
                } else {
                    alert('Please select an image to upload.');
                    return;
                }

                formData.append('workerId', $('#ppTxtWorkerId').val());  // Add WorkerId to formData

                $.ajax({
                    url: '/api/Worker/UploadProfileImage',  // Adjust URL as necessary
                    type: 'POST',
                    data: formData,
                    processData: false,  // Prevent jQuery from processing data
                    contentType: false,  // Prevent jQuery from setting contentType
                    success: function (response) {
                        if (response.success) {
                            alert(response.message);  // Alert user
                            window.location.reload();
                           
                        } else {
                            alert('Error: ' + response.message);  // Alert if error occurs
                        }
                    },
                    // success: function (response) {
                    //     if (response.success) {
                    //         console.log('Updated file path:', response.filePath);

                    //         // Force update the profile image with the new path
                    //         $('#profileImage').css('background-image', `url('${response.filePath}?t=${new Date().getTime()}')`);

                    //         // Hide the modal after successful upload
                    //         $('#ppUploadImageModal').modal('hide');
                    //     } else {
                    //         alert('Error: ' + response.message);
                    //     }
                    // },
                    error: function (xhr, status, error) {
                        console.error(error);
                        alert('An error occurred while uploading the image.');
                    }
                });
            });
        });


        $(document).ready(function () {



            // Open modal when the button is clicked
            $('.btn-upload').on('click', function () {
                $('#uploadImageModal').modal('show');
                let data = $(this).data();
                $('#txtDocumentName').val(data.document_name);
                $('#txtDocumentNumber').val(data.document_number);
                $('#txtDocumentId').val(data.document_id);
                $('#txtWorkerId').val(data.worker_id);

                $('#documentImage').val(data.document_image);

                if(data.is_document_number == "False")
                {
                    $('.isDocumentNumber').hide();

                }else{
                    $('.isDocumentNumber').show();
                }


                if(data.is_document_image== "False")
                {
                    $('.isDocumentImage').hide();

                }else{
                    $('.isDocumentImage').show();
                }

                $('#imageInput').val('');
                $('#imagePreview').addClass('d-none');
            });

            $('.btnCloseModal').on('click', function () {
                $('#uploadImageModal').modal('hide');
            });

            // JavaScript to handle image preview
            document.getElementById('imageInput').addEventListener('change', function (event) {
                const imageInput = event.target;
                const preview = document.getElementById('imagePreview');

                if (imageInput.files && imageInput.files[0]) {
                    const reader = new FileReader();

                    reader.onload = function (e) {
                        preview.src = e.target.result;
                        preview.classList.remove('d-none'); // Show the preview image
                    };

                     reader.readAsDataURL(imageInput.files[0]);
                } else {
                    preview.src = '#';
                    preview.classList.add('d-none'); // Hide the preview image
                }
            });

            // Handle form submission via AJAX
            $('#imageUploadForm').on('submit', function (e) {
                    e.preventDefault();

                    var formData = new FormData();
                    const fileInput = document.getElementById('imageInput');

                    // Ensure file is selected
                      if (!fileInput.files || fileInput.files.length === 0) {
                          // alert('You Have Not Selected Document File.');

                          if(!confirm ('Are You Sure You Want To Continue Without Selecting File? '))
                          {
                              return;
                          }
                      }
                      else
                      {
                         formData.append('file', fileInput.files[0]);

                      }


                // Add parameters
                formData.append('WorkerId', $('#txtWorkerId').val());

                formData.append('DocumentId', $('#txtDocumentId').val());
                formData.append('DocumentNumber', $('#txtDocumentNumber').val());
                formData.append('DocumentImage', $('#documentImage').val());


                // Send AJAX request
                $.ajax({
                    url: '/api/Worker/UploadDocument',
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function (response) {
                        console.log(response);
                        if (response.success) {
                            alert('Document uploaded successfully!');
                            location.reload();
                        } else {
                            alert('Error: ' + response.message);
                        }
                    },
                    error: function (xhr, status, error) {
                        console.error('AJAX Error Status:', status);
                        console.error('AJAX Error Message:', error);
                        console.error('AJAX Response Text:', xhr.responseText);
                        alert('An error occurred while uploading the document.');
                    }
                });
        });

        });


            $('#btnSaveformWorkerShift').click(()=>{
                
                $('#formWorkerShift').submit();
            })

            function EditShift(){
                $('#btnEditShift').addClass('d-none');
                $('#card-workershift-form').removeClass('d-none');
            }

            function cancelShift(){
                $('#btnEditShift').removeClass('d-none');
                $('#card-workershift-form').addClass('d-none');
            }

            // Handle form submission via AJAX
            $('#formWorkerShift').on('submit', function (e) {
                    e.preventDefault();

                    var formData = new FormData();

                // Add parameters
                formData.append('workerId', $('#txtWorkerId1').val());

                formData.append('shiftId', $('#drpShiftId').val());

                // Send AJAX request
                $.ajax({
                    url: '/api/Worker/ChangeWorkerShift',
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function (response) {
                        console.log(response);
                        if (response.success) {
                            alert('Shift updated successfully!');
                            location.reload();
                        } else {
                            alert('Error: ' + response.message);
                        }
                    },
                    error: function (xhr, status, error) {
                        console.error('AJAX Error Status:', status);
                        console.error('AJAX Error Message:', error);
                        console.error('AJAX Response Text:', xhr.responseText);
                        alert('An error occurred while updating shfit.');
                    }
                });
        });


        //For Document Verification 
         $("#closeModel").click(() => {
            $("#verify_model").modal('hide')
        })

        $('#verify_model').on('shown.bs.modal', function () {

            $('#formVerify').submit((e) => {
                e.preventDefault();                          //  form submission for debugging

                $('#formVerify').off('submit').submit();
            });
        });

        $('.btn-verify').click((event) => {
            const documentId = $(event.currentTarget).data('document-id');
             $('#verify_id').val(documentId);
            // const data_id = $(event.currentTarget).data('data_id');
            // $('#WorkerDocumentId').val(data_id);
            $("#verify_model").modal('show')

        })


    </script>

}

        @*              $.ajax({
                url: '/Worker/VerifyDocument',
                type: 'POST',
                data: { id: documentId, IsVerified: true },
                success: function (response) {
                    // Update the specific row in the table dynamically
                    const row = $(`[data-document-id="${documentId}"]`).closest('tr');
                    row.find('.status-icon').removeClass('bg-danger').addClass('bg-success'); // Change icon
                    row.find('span:contains("Not Verified")').text("Verified"); // Change text
                    row.find('.btn-verify').remove(); // Remove the Verify button

                    // Hide the modal
                    $('#verify_model').modal('hide');
                },
                error: function () {
                    alert('Error verifying the document.');
                }
            });
        });
 *@
